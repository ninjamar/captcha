<!DOCTYPE html>
<html>
    <head>
        <title>CAPTCHA Demo</title>
        <script src="./example.js"></script>
        <script>
            document.addEventListener("DOMContentLoaded", () => {
                let notice = document.querySelector(".notice");

                let params = new URLSearchParams(window.location.search);
                let captchaID = params.get("captcha-id");
                let captchaResponse = params.get("captcha-response");
                if (captchaID && captchaResponse){
                    // Verify captcha
                    fetch("http://localhost:8787/v1/verify_captcha", {
                        method: "POST",
                        body: JSON.stringify({id: captchaID, response: captchaResponse})
                    }).then(res => res.json()).then(json => {
                        if (json.success){
                            notice.textContent = "Captcha verified";
                        } else {
                            notice.textContent = "Wrong captcha, please try again"; // TODO: Keep form data
                        }
                    });
                } else {
                    captcha.use(document.querySelector(".captcha"));
                }
            });
        </script>
        <style>
            * {
                font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            }
            .body {
                width: 50%;
                margin: auto;
            }
            .notice {
                color: red;
            }
        </style>
    </head>
    <body>
        <div class="body">
            <p class="notice"></p>
            <a href="#" onclick="event.preventDefault(); window.location = window.location.pathname;">Reset</a>
            <p>This is a very simple CAPTCHA demonstration (don't use this in production)</p>
            <form id="demo-form" action="">
                <label for="foo">Foo</label><br>
                <input type="text" name="foo" value="Test"><br>
                <label for="bar">Bar</label><br>
                <input type="text" name="bar" value="Test"><br>
                <div class="captcha"></div>
                <input type="submit" value="Submit" disabled>
            </form>
        </div>
    </body>
</html>